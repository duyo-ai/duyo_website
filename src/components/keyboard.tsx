'use client'

import { clsx } from 'clsx'
import { motion } from 'framer-motion'
import { createContext, useContext } from 'react'

const KeyboardContext = createContext<{ highlighted: string[] }>({
  highlighted: [],
})

function Row(props: { children: React.ReactNode }) {
  return <div {...props} className="group flex h-9 gap-2" />
}

function Key({
  name,
  width = 36,
  className,
  children,
}: {
  name: string
  width?: number
  className?: string
  children?: React.ReactNode
}) {
  let { highlighted } = useContext(KeyboardContext)

  return (
    <motion.div
      variants={
        highlighted.includes(name)
          ? {
              idle: {
                scale: 1,
                boxShadow: `rgb(255, 255, 255) 0px 0px 0px 0px, rgba(47, 127, 221, 0.8) 0px 0px 0px 1px, rgba(47, 127, 221, 0.15) 0px 0px 3px 3px,rgba(47, 127, 221, 0.1) 0px 0px 0px 0px`,
              },
              active: {
                scale: [1, 1.02, 1.02, 1],
                boxShadow: [
                  `rgb(255, 255, 255) 0px 0px 0px 0px, rgba(47, 127, 221, 0.8) 0px 0px 0px 1px, rgba(47, 127, 221, 0.15) 0px 0px 3px 3px, rgba(47, 127, 221, 0.05) 0px 0px 0px 0px`,
                  `rgb(255, 255, 255) 0px 0px 0px 0px, rgba(47, 127, 221, 0.8) 0px 0px 0px 1px, rgba(47, 127, 221, 0.1) 0px 0px 1px 6px, rgba(47, 127, 221, 0.05) 0px 0px 1px 15px`,
                  `rgb(255, 255, 255) 0px 0px 0px 0px, rgba(47, 127, 221, 0.8) 0px 0px 0px 1px, rgba(47, 127, 221, 0.0) 0px 0px 1px 6px, rgba(47, 127, 221, 0.01) 0px 0px 1px 15px`,
                  `rgb(255, 255, 255) 0px 0px 0px 0px, rgba(47, 127, 221, 0.8) 0px 0px 0px 1px, rgba(47, 127, 221, 0.0) 0px 0px 3px 3px, rgba(47, 127, 221, 0.00) 0px 0px 0px 0px`,
                ],
                transition: {
                  repeat: Infinity,
                  ease: 'easeInOut',
                  duration: 1.75 - highlighted.indexOf(name) * 0.35,
                  delay: highlighted.indexOf(name) * 0.35,
                  repeatDelay: 1 + highlighted.indexOf(name) * 0.35,
                },
              },
            }
          : undefined
      }
      style={{ width: `${width / 16}rem` }}
      className={clsx(
        className,
        'flex flex-col items-center justify-center gap-0.5 px-1 py-px',
        'rounded bg-white bg-gradient-to-t from-black/[3%] shadow-[0_1px_rgb(0_0_0_/_0.05)] ring-1 ring-black/10',
        '[:where(&_svg)]:h-3.5 [:where(&_svg)]:fill-gray-600',
      )}
    >
      {children}
    </motion.div>
  )
}

export function Keyboard({ highlighted = [] }: { highlighted?: string[] }) {
  return (
    <KeyboardContext.Provider value={{ highlighted }}>
      <div aria-hidden="true" className="flex flex-col gap-2">
        <div className="group flex h-9 gap-2">
          <Key name="LeftCommand" width={94}>
            <svg viewBox="0 0 18 14" className="mr-auto mt-auto">
              <path d="M15.91 5.902v-1.03h.7v1.03h.93v.575h-.93v2.367c0 .242.048.405.144.488.096.08.27.121.52.121.049 0 .107-.002.175-.008l.149-.011V10a4.384 4.384 0 0 1-.504.035c-.326 0-.574-.042-.746-.125A.683.683 0 0 1 16 9.52a2.046 2.046 0 0 1-.094-.672V6.477h-.629v-.575h.633ZM12.898 10V6.477h-.691v-.575h.691v-.41c0-.396.1-.686.301-.87.2-.188.53-.282.989-.282a4.79 4.79 0 0 1 .468.023v.57a1.49 1.49 0 0 0-.168-.011 6.391 6.391 0 0 0-.199-.004c-.242 0-.418.044-.527.133-.11.086-.164.251-.164.496v.355h.953v.575h-.946V10h-.707ZM10.348 10V5.89h.707V10h-.707Zm-.149-5.375c0-.143.047-.26.14-.352a.498.498 0 0 1 .356-.136c.149 0 .271.045.367.136a.462.462 0 0 1 .145.352c0 .14-.048.257-.145.348a.513.513 0 0 1-.367.136.498.498 0 0 1-.355-.136.464.464 0 0 1-.14-.348ZM5.488 10V4.387h.707v2.25h.035c.03-.094.088-.205.176-.332.091-.13.226-.242.403-.336.177-.097.407-.145.691-.145.398 0 .728.115.988.344.263.23.395.574.395 1.035V10h-.707V7.426c0-.216-.038-.397-.114-.543a.725.725 0 0 0-.316-.332 1 1 0 0 0-.48-.11.998.998 0 0 0-.59.168 1.033 1.033 0 0 0-.36.457c-.08.193-.12.408-.12.645V10h-.708ZM1.21 7.07c0-.291.073-.528.216-.71.146-.186.334-.32.566-.407.235-.086.485-.129.75-.129.297 0 .555.048.774.145.221.096.393.23.515.402a1 1 0 0 1 .184.602h-.656a.576.576 0 0 0-.106-.282.67.67 0 0 0-.277-.222 1.02 1.02 0 0 0-.457-.09c-.24 0-.438.053-.594.16a.527.527 0 0 0-.23.461.45.45 0 0 0 .093.297.677.677 0 0 0 .242.176c.102.041.213.074.333.097.12.024.236.046.351.067.258.044.492.105.703.183.214.076.384.19.512.34.128.149.191.357.191.625 0 .274-.069.507-.207.7-.135.19-.327.334-.574.433a2.284 2.284 0 0 1-.86.148c-.304 0-.572-.044-.804-.132a1.21 1.21 0 0 1-.543-.387 1.005 1.005 0 0 1-.195-.625h.691c.018.122.06.228.125.316a.63.63 0 0 0 .285.207c.125.047.283.07.473.07.216 0 .39-.03.523-.09a.657.657 0 0 0 .297-.234.583.583 0 0 0 .094-.324c0-.153-.046-.27-.137-.351a.902.902 0 0 0-.37-.184 6.195 6.195 0 0 0-.52-.121 5.53 5.53 0 0 1-.7-.188 1.165 1.165 0 0 1-.5-.332c-.125-.145-.187-.352-.187-.62Z" />
            </svg>
          </Key>
          <Key name="LeftShift" width={94}>
            <svg viewBox="0 0 18 14" className="mr-auto mt-auto">
              <path d="M15.91 5.902v-1.03h.7v1.03h.93v.575h-.93v2.367c0 .242.048.405.144.488.096.08.27.121.52.121.049 0 .107-.002.175-.008l.149-.011V10a4.384 4.384 0 0 1-.504.035c-.326 0-.574-.042-.746-.125A.683.683 0 0 1 16 9.52a2.046 2.046 0 0 1-.094-.672V6.477h-.629v-.575h.633ZM12.898 10V6.477h-.691v-.575h.691v-.41c0-.396.1-.686.301-.87.2-.188.53-.282.989-.282a4.79 4.79 0 0 1 .468.023v.57a1.49 1.49 0 0 0-.168-.011 6.391 6.391 0 0 0-.199-.004c-.242 0-.418.044-.527.133-.11.086-.164.251-.164.496v.355h.953v.575h-.946V10h-.707ZM10.348 10V5.89h.707V10h-.707Zm-.149-5.375c0-.143.047-.26.14-.352a.498.498 0 0 1 .356-.136c.149 0 .271.045.367.136a.462.462 0 0 1 .145.352c0 .14-.048.257-.145.348a.513.513 0 0 1-.367.136.498.498 0 0 1-.355-.136.464.464 0 0 1-.14-.348ZM5.488 10V4.387h.707v2.25h.035c.03-.094.088-.205.176-.332.091-.13.226-.242.403-.336.177-.097.407-.145.691-.145.398 0 .728.115.988.344.263.23.395.574.395 1.035V10h-.707V7.426c0-.216-.038-.397-.114-.543a.725.725 0 0 0-.316-.332 1 1 0 0 0-.48-.11.998.998 0 0 0-.59.168 1.033 1.033 0 0 0-.36.457c-.08.193-.12.408-.12.645V10h-.708ZM1.21 7.07c0-.291.073-.528.216-.71.146-.186.334-.32.566-.407.235-.086.485-.129.75-.129.297 0 .555.048.774.145.221.096.393.23.515.402a1 1 0 0 1 .184.602h-.656a.576.576 0 0 0-.106-.282.67.67 0 0 0-.277-.222 1.02 1.02 0 0 0-.457-.09c-.24 0-.438.053-.594.16a.527.527 0 0 0-.23.461.45.45 0 0 0 .093.297.677.677 0 0 0 .242.176c.102.041.213.074.333.097.12.024.236.046.351.067.258.044.492.105.703.183.214.076.384.19.512.34.128.149.191.357.191.625 0 .274-.069.507-.207.7-.135.19-.327.334-.574.433a2.284 2.284 0 0 1-.86.148c-.304 0-.572-.044-.804-.132a1.21 1.21 0 0 1-.543-.387 1.005 1.005 0 0 1-.195-.625h.691c.018.122.06.228.125.316a.63.63 0 0 0 .285.207c.125.047.283.07.473.07.216 0 .39-.03.523-.09a.657.657 0 0 0 .297-.234.583.583 0 0 0 .094-.324c0-.153-.046-.27-.137-.351a.902.902 0 0 0-.37-.184 6.195 6.195 0 0 0-.52-.121 5.53 5.53 0 0 1-.7-.188 1.165 1.165 0 0 1-.5-.332c-.125-.145-.187-.352-.187-.62Z" />
            </svg>
          </Key>
          <Key name="D" width={36}>
            <svg viewBox="0 0 10 14">
              <path d="M1.292 2.668h3.035c.907 0 1.664.178 2.27.533.61.351 1.068.873 1.374 1.566.31.692.465 1.547.465 2.563 0 1.012-.155 1.866-.465 2.564-.306.692-.764 1.216-1.374 1.572-.606.355-1.363.533-2.27.533H1.292V2.668Zm1.258 1.1v7.124h1.688c.483 0 .907-.073 1.272-.22.364-.15.665-.373.902-.67.237-.295.415-.664.533-1.106.123-.443.185-.962.185-1.56 0-.792-.107-1.453-.321-1.982-.21-.528-.529-.925-.957-1.189-.429-.264-.967-.396-1.614-.396H2.55Z" />
            </svg>
          </Key>
        </div>
      </div>
    </KeyboardContext.Provider>
  )
} 